apply plugin: 'com.jfrog.bintray'
apply plugin: 'maven-publish'

buildscript {
    ext.kotlinVersion = '1.3.72'
    repositories {
        google()
        jcenter()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:4.0.1'
        classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.8.5'
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion"
        classpath "org.jetbrains.kotlin:kotlin-serialization:$kotlinVersion"
    }
}

allprojects {
    repositories {
        mavenLocal()
        google()
        jcenter()
        flatDir { dirs 'libs' }
        maven { url 'https://dl.bintray.com/ironsource-mobile/android-adapters' }
        maven { url 'https://dl.bintray.com/ironsource-mobile/android-sdk' }
    }
}

ext {
    compileSdkVersion = 30
    buildToolsVersion = '30.0.1'
    targetSdkVersion = 30
    buildPrefab = true
    buildMaven = true
}

project.bintray {
    user = "${BINTRAY_USER}"
    key = "${BINATRY_API_KEY}"
    publications = ['core', 'ads', 'admob', 'admob-mediation']
}

def applyPrefabSettings(project, String libraryName, headerPaths) {
    /*
    Wait for AndroidStudio4.1
    
    def projectDir = project.projectDir
    project.android {
        ndkVersion '21.3.6528147'

        buildFeatures {
            prefabPublishing true
        }

        externalNativeBuild {
            cmake {
                path "$projectDir/CMakeLists.txt"
            }
        }

        prefab {
            "$libraryName" {
                headers "$projectDir/.generated_headers"
            }
        }
    }

    project.preBuild.dependsOn(tasks.create(name: "${libraryName}CopyHeaders") {
        doFirst {
            delete {
                delete "$projectDir/.generated_headers"
            }
            copy {
                from '../src'
                into "$projectDir/.generated_headers"
                headerPaths.each { item ->
                    include item
                }
            }
        }
    })
     */
}

def publishToMaven(project, String libraryName) {
    project.afterEvaluate {
        publishing {
            publications {
                create(libraryName, MavenPublication) {
                    from project.components.release
                    groupId = 'com.senspark.ee'
                    artifactId = libraryName
                    version = '1.0.0'
                }
            }
        }
        project.bintray {
            pkg {
                repo = 'ee-x'
                name = libraryName
                licenses = ['MIT']
                vcsUrl = 'https://github.com/Senspark/ee-x.git'
                version {
                    name = '1.0.0'
                }
            }
        }
    }
}

publishing {
    repositories {
        maven {
            url "$buildDir/repo"
        }
    }
}